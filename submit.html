<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>λ§›μ§‘λ””λΉ„λ“±λ΅ν•κΈ°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
    <style>
        #container {
            max-width:600px;
            margin-left:auto;
            margin-right:auto;
        }
    </style>
</head>
<body>
    <div id="container">
        <h1>λ§›μ§‘λ“±λ΅π¤£</h1>
        <b>λ””λΉ„λ¥Ό μ±„μ›μ£Όμ„Έμ”!</b>
        <form method="get" action="https://backend.rainclab.workers.dev/api/post" id="forsubmit">
            <div class="form-floating mb-3">
                <input required name="name" type="text" class="form-control" id="mealname" placeholder="λ§›μλ”μ μ΅μ‹λ‹Ή">
                <label for="mealname">λ§›μ§‘ μ΄λ¦„μ„ μ•λ ¤μ£Όμ„Έμ”!π‹</label>
            </div>
            <div class="form-floating mb-3">
                <input onclick="openAddress()" name="locations" type="text" class="form-control" id="address" placeholder="μ„μΈ μ„μ΄κµ¬ μ‚¬μ„λ‹Ήλ΅ 111-4">
                <label for="address">μ£Όμ†λ¥Ό μ…λ ¥ν•΄ μ£Όμ„Έμ”! μμ‹)μ„μ΄κµ¬ λ¬΄μ¨λ™ λ¬΄μ¨λ΅ 33</label>
            </div>
            <input id="hiddenaddress" type="hidden" name="address"/> 
            <div class="form-floating mb-3">
                <select class="form-select" name="mealtype" id="floatingSelect" aria-label="Floating label select example">
                  <option selected>μ„ νƒν•μ„Έμ”! </option>
                  <option value="κ°„μ‹">κ°„μ‹</option>
                  <option value="λ¶„μ‹">λ¶„μ‹</option>
                  <option value="λ·”ν">λ·”ν</option>
                  <option value="ν•μ‹ ">ν•μ‹</option>
                  <option value="μ¤‘μ‹">μ¤‘μ‹</option>
                  <option value="μΌμ‹">μΌμ‹</option>
                  <option value="ν¨μ¤νΈν‘Έλ“">ν¨μ¤νΈν‘Έλ“</option>
                  <option value="ν”Όμ">ν”Όμ</option>
                  <option value="μΉν‚¨">μΉν‚¨</option> 
                </select>
                <label for="floatingSelect">μμ‹μ μΆ…λ¥λ¥Ό μ•λ ¤μ£Όμ„Έμ”! π</label>
              </div>
            <div class="form-floating mb-3">
                <select class="form-select" name="feel" id="feel" aria-label="Floating label select example">
                    <option selected>μ„ νƒν•μ„Έμ”! </option>
                    <option value="λ„“μ€">λ„“μ€</option>
                    <option value="λ¶„μ„κΈ°μΆ‹μ€">λ¶„μ„κΈ°μΆ‹μ€</option>
                    <option value="μΈν…λ¦¬μ–΄">μΈν…λ¦¬μ–΄</option>
                    <option value="ν‰λ²”">ν‰λ²”</option>
                  </select>
                  <label for="feel">λ¶„μ„κΈ°λ” μ–΄λ• μ„κΉμ”? π(λ„“μ€,λ¶„μ„κΈ°μΆ‹μ€,μΈν…λ¦¬μ–΄)</label>
            </div>
            <div class="form-floating mb-3">
                <select class="form-select" name="price" id="price" aria-label="Floating label select example">
                    <option selected>μ„ νƒν•μ„Έμ”! </option>
                    <option value="λΉ„μ‹Ό">λΉ„μ‹Ό(2λ§μ›μ΄μƒ)</option>
                    <option value="λ³΄ν†µ">λ³΄ν†µ(1λ§μ›~)</option>
                    <option value="μ €λ ΄ν•">μ €λ ΄ν•(1λ§μ›μ΄ν•)</option>
                  </select>
                  <label for="price">κ°€κ²©μ„ λ³΄ν†µ, λΉ„μ‹Ό, μ‹Ό μ¤‘ ν•λ‚λ¥Ό μ…λ ¥ν•΄ μ£Όμ„Έμ”~π†</label>
            </div>
            <div class="form mb-5">
                <label for="customRange2" class="form-label">ν‰μ μ€?π¥Ί</label>
                <b id="ratingtext">4μ μ„ μ¤„κ²μ”.π‹</b>
                <input name="rating" onchange="ratingtext.innerHTML=this.value + 'μ μ„ μ¤„κ²μ”.π‹'" type="range" class="form-range" step="0.5"  min="3.0" max="5.0" id="customRange2">
            </div>
            <div class="form-floating mb-3">
                <input required name="review_content" type="text" class="form-control" id="review_content" placeholder="4.5">
                <label for="review_content">λ¦¬λ·°ν•κ³  μ‹¶μ€ λ‚΄μ© (λ§›μ§‘ ν΄λ¦­ μ‹ λ‚μ¤λ” λ‚΄μ©μ…λ‹λ‹¤.)π€</label>
            </div>
            <div class="form-floating mb-3">
                <input readonly name="lat" type="text" class="form-control" id="lat" placeholder="4.5">
                <label for="lat">μ„λ„( μ£Όμ† μ…λ ¥μ‹ μλ™ μ…λ ¥λ¨ )π‚</label>
            </div>
            <div class="form-floating mb-3">
                <input readonly name="lng" type="text" class="form-control" id="lng" placeholder="4.5">
                <label for="lng">κ²½λ„( μ£Όμ† μ…λ ¥μ‹ μλ™ μ…λ ¥λ¨ )π‚</label>
            </div>
        </form>
        <div id="map" style=" width:100%;height:400px;">

        </div>
        <button type="button" id="submitbtn" class="btn btn-outline-primary">μ΄λ€λ΅ λ“±λ΅ν• κ²μ”π€</button>
        <b>κ΄€λ¦¬μ μΉμΈν›„μ— λ“±λ΅λ©λ‹λ‹¤π‘</b>
    </div>
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=57a63270870e59dc71bf6117850386e9&libraries=services,clusterer&autoload=true"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
    <script>
        let mapOptions = {
            center:[37.5, 127.6],
            zoom:10
        }
        const API_URL = "https://backend.rainclab.workers.dev"
        submitbtn.onclick = () => {
            const form = document.getElementById("forsubmit");
            const parameter = new URLSearchParams(new FormData(form)).toString()
            fetch(`${API_URL}/api/post?${parameter}`).then(res => res.json())
            .then(json => {
                console.log(json)
                alert(json.message_ko_KR)
            }).catch((e) => {
                console.log(e)
            })
            // const request = new XMLHttpRequest();
            // request.send(params);
        
        }
 
        let map = new L.map('map' , mapOptions, );
        let layer = new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
        let markerLists = []
        map.addLayer(layer);
        function addMarkers(x, y, data) {
            // let marker = new L.Marker([x, y], {icon: greenIcon});
            let marker = new L.Marker([x, y] );
            marker.addTo(map).bindPopup(data).openPopup();
            markerLists.push(marker)
        }
        function removeMarkers() {
            for(var i = 0; i < markerLists.length; i++)  {
                map.removeLayer(markerLists[i]);
            }
        }
 
        function openAddress() {
            new daum.Postcode({
                oncomplete: function(data) {
                    console.log(data)
                    // νμ—…μ—μ„ κ²€μƒ‰κ²°κ³Ό ν•­λ©μ„ ν΄λ¦­ν–μ„λ• μ‹¤ν–‰ν•  μ½”λ“λ¥Ό μ‘μ„±ν•λ” λ¶€λ¶„μ…λ‹λ‹¤.
                    // μμ λ¥Ό μ°Έκ³ ν•μ—¬ λ‹¤μ–‘ν• ν™μ©λ²•μ„ ν™•μΈν•΄ λ³΄μ„Έμ”.
                    address.value = data.sigungu
                    var geocoder = new kakao.maps.services.Geocoder(); 
                    var callback = function(result, status) { 
                        if (status === kakao.maps.services.Status.OK) {
                            lat.value = result[0].y
                            lng.value = result[0].x 
                            addMarkers(result[0].y, result[0].x, "μ—¬κΈ°λ¥Ό λ“±λ΅ν• κ»μ”π")
                            var targetZoomLevel = 17; // μ›ν•λ” μ¤ λ λ²¨μ„ μ„¤μ •ν•©λ‹λ‹¤. 
                            map.setView([result[0].y, result[0].x], targetZoomLevel);
                        }
                        
                    }; 
                    hiddenaddress.value = data.address
                    geocoder.addressSearch(data.address, callback);
                    
                }
            }).open();
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</body> 
</html>